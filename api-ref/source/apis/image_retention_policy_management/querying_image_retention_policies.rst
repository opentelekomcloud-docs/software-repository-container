:original_name: swr_02_0053.html

.. _swr_02_0053:

Querying Image Retention Policies
=================================

Description
-----------

Query image retention policies.

Constraints
-----------

None

URI
---

GET /v2/manage/namespaces/{namespace}/repos/{repository}/retentions

.. table:: **Table 1** Path parameters

   +------------+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +============+===========+========+=================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | namespace  | Yes       | String | Organization name. Enter 1 to 64 characters, starting with a lowercase letter and ending with a lowercase letter or digit. Only lowercase letters, digits, periods (.), underscores (_), and hyphens (-) are allowed. Periods, underscores, and hyphens cannot be placed next to each other. A maximum of two consecutive underscores are allowed.                                                                              |
   +------------+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | repository | Yes       | String | Image repository name. Enter 1 to 128 characters. It must start and end with a lowercase letter or digit. Only lowercase letters, digits, periods (.), slashes (/), underscores (_), and hyphens (-) are allowed. Periods, slashes, underscores, and hyphens cannot be placed next to each other. A maximum of two consecutive underscores are allowed. Replace a slash (/) with a dollar sign ($) before you send the request. |
   +------------+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                 |
   +=================+=================+=================+=============================================================================================================================+
   | Content-Type    | Yes             | String          | Message body type (format). The value can be **application/json** or **charset=utf-8 application/json**.                    |
   |                 |                 |                 |                                                                                                                             |
   |                 |                 |                 | Default value: **application/json**                                                                                         |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------+
   | X-Auth-Token    | Yes             | String          | User token.                                                                                                                 |
   |                 |                 |                 |                                                                                                                             |
   |                 |                 |                 | The token can be obtained by calling an IAM API. The value of **X-Subject-Token** in the response header is the user token. |
   +-----------------+-----------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------+

.. note::

   By default, 100 records will be returned.

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 3** Response body parameter

   +-----------+--------------------------------------------------------------------------------------------------+------------------+
   | Parameter | Type                                                                                             | Description      |
   +===========+==================================================================================================+==================+
   | [items]   | Array of :ref:`Retention <swr_02_0053__en-us_topic_0000001231195479_response_retention>` objects | Query succeeded. |
   +-----------+--------------------------------------------------------------------------------------------------+------------------+

.. _swr_02_0053__en-us_topic_0000001231195479_response_retention:

.. table:: **Table 4** Retention

   +-----------+----------------------------------------------------------------------------------------+------------------------------------------------------+
   | Parameter | Type                                                                                   | Description                                          |
   +===========+========================================================================================+======================================================+
   | algorithm | String                                                                                 | Retention policy matching rule. The value is **or**. |
   +-----------+----------------------------------------------------------------------------------------+------------------------------------------------------+
   | id        | Integer                                                                                | ID                                                   |
   +-----------+----------------------------------------------------------------------------------------+------------------------------------------------------+
   | rules     | Array of :ref:`Rule <swr_02_0053__en-us_topic_0000001231195479_response_rule>` objects | Image retention policy.                              |
   +-----------+----------------------------------------------------------------------------------------+------------------------------------------------------+
   | scope     | String                                                                                 | Reserved field.                                      |
   +-----------+----------------------------------------------------------------------------------------+------------------------------------------------------+

.. _swr_02_0053__en-us_topic_0000001231195479_response_rule:

.. table:: **Table 5** Rule

   +---------------+------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter     | Type                                                                                                 | Description                                                                                                                                                   |
   +===============+======================================================================================================+===============================================================================================================================================================+
   | template      | String                                                                                               | Retention policy type. The value can be **date_rule** and **tag_rule**.                                                                                       |
   +---------------+------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | params        | Object                                                                                               | If **template** is set to **date_rule**, set **params** to **{"days": "xxx"}**. If **template** is set to **tag_rule**, set **params** to **{"num": "xxx"}**. |
   +---------------+------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | tag_selectors | Array of :ref:`TagSelector <swr_02_0053__en-us_topic_0000001231195479_response_tagselector>` objects | Exception images.                                                                                                                                             |
   +---------------+------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _swr_02_0053__en-us_topic_0000001231195479_response_tagselector:

.. table:: **Table 6** TagSelector

   +-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type   | Description                                                                                                                                         |
   +===========+========+=====================================================================================================================================================+
   | kind      | String | Matching rule. The value can be **label** or **regexp**.                                                                                            |
   +-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
   | pattern   | String | If **kind** is set to **label**, set this parameter to the image tag. If **kind** is set to **regexp**, set this parameter to a regular expression. |
   +-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------+

Example Request
---------------

.. code-block:: text

   GET https://{endpoint}/v2/manage/namespaces/{namespace}/repos/{repository}/retentions

Example Response
----------------

**Status code: 200**

Query succeeded.

.. code-block::

   [ {
     "algorithm" : "or",
     "id" : 222,
     "rules" : [ {
       "params" : {
         "days" : "30"
       },
       "tag_selectors" : [ {
         "kind" : "label",
         "pattern" : "v5"
       }, {
         "kind" : "label",
         "pattern" : "1.0.1"
       }, {
         "kind" : "regexp",
         "pattern" : "^123$"
       } ],
       "template" : "date_rule"
     } ],
     "scope" : ""
   } ]

Status Codes
------------

=========== =============================================
Status Code Description
=========== =============================================
200         Query succeeded.
400         Request error.
401         Authentication failed.
404         The organization or repository was not found.
500         Internal error.
=========== =============================================

Error Codes
-----------

For details, see :ref:`Error Codes <errorcode>`.
